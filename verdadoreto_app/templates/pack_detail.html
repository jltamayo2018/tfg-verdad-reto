{% extends "base.html" %}
{% block title %}{{ pack.name }}{% endblock %}

{% block content %}
  <h2 class="neon-title">{{ pack.name }}</h2>
  <p><a class="btn btn-ghost" href="{% url 'dashboard' %}">â† Volver a mis packs</a></p>

  <!-- ACCIONES DEL PACK -->
  <div class="card neon-card pack-detail">
    <h3>Acciones del pack</h3>

    <!-- VERDAD -->
    <details class="accordion">
      <summary class="accordion-header">
        <span class="chip chip-truth">Preguntas</span>
        <a class="btn btn-primary btn-sm" href="{% url 'action_create' pack.pk 'verdad' %}">+ AÃ±adir Pregunta</a>
      </summary>

      {% if verdades %}
        <ul class="list-clean">
          {% for a in verdades %}
            <li class="action-item">
              <div class="action-text">
                {% if not a.active %}
                  <span class="badge badge-inactive">(inactiva)</span>
                {% endif %}
                {{ a.text|default:"(sin texto)" }}
              </div>

              <div class="action-tools">
                <a class="icon-btn" href="{% url 'action_edit' pack.pk a.pk %}" title="Editar" aria-label="Editar">âœï¸</a>

                <form method="post" action="{% url 'action_toggle' pack.pk a.pk %}" class="inline">
                  {% csrf_token %}
                  <button type="submit"
                          class="icon-btn"
                          title="{% if a.active %}Desactivar{% else %}Activar{% endif %}"
                          aria-label="{% if a.active %}Desactivar{% else %}Activar{% endif %}">
                    {% if a.active %}â›”{% else %}âœ…{% endif %}
                  </button>
                </form>

                <a class="icon-btn danger" href="{% url 'action_delete' pack.pk a.pk %}" title="Borrar" aria-label="Borrar">ğŸ—‘ï¸</a>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="muted">No hay verdades todavÃ­a.</p>
      {% endif %}
    </details>

    <!-- RETO -->
    <details class="accordion">
      <summary class="accordion-header">
        <span class="chip chip-dare">Retos</span>
        <a class="btn btn-primary btn-sm" href="{% url 'action_create' pack.pk 'reto' %}">+ AÃ±adir Reto</a>
      </summary>

      {% if retos %}
        <ul class="list-clean">
          {% for a in retos %}
            <li class="action-item">
              <div class="action-text">
                {% if not a.active %}
                  <span class="badge badge-inactive">(inactiva)</span>
                {% endif %}
                {{ a.text|default:"(sin texto)" }}
              </div>

              <div class="action-tools">
                <a class="icon-btn" href="{% url 'action_edit' pack.pk a.pk %}" title="Editar" aria-label="Editar">âœï¸</a>

                <form method="post" action="{% url 'action_toggle' pack.pk a.pk %}" class="inline">
                  {% csrf_token %}
                  <button type="submit"
                          class="icon-btn"
                          title="{% if a.active %}Desactivar{% else %}Activar{% endif %}"
                          aria-label="{% if a.active %}Desactivar{% else %}Activar{% endif %}">
                    {% if a.active %}â›”{% else %}âœ…{% endif %}
                  </button>
                </form>

                <a class="icon-btn danger" href="{% url 'action_delete' pack.pk a.pk %}" title="Borrar" aria-label="Borrar">ğŸ—‘ï¸</a>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="muted">No hay retos todavÃ­a.</p>
      {% endif %}
    </details>
  </div>

  <!-- ENLACES PÃšBLICOS -->
  <div class="card neon-card public-links">
    <h3>Enlaces pÃºblicos</h3>

    <div class="public-block">
      <h4>Preguntas</h4>
      <p>
        <a id="link-verdad" href="{% url 'publico_por_token' pack.token_verdad %}">
          Â¿Comenzamos con las preguntas?
        </a>
        Â· <a href="{% url 'qr_image' pack.pk 'verdad' %}">Descargar QR</a>
      </p>
      <form method="post" action="{% url 'link_regenerate' pack.pk 'verdad' %}" class="inline">
        {% csrf_token %}
        <button type="submit" class="btn btn-secondary btn-sm"
                onclick="return confirm('Â¿Regenerar enlace de Verdad? El anterior dejarÃ¡ de funcionar.')">
          Regenerar enlace
        </button>
      </form>
    </div>

    <div class="public-block">
      <h4>Retos</h4>
      <p>
        <a id="link-reto" href="{% url 'publico_por_token' pack.token_reto %}">
          Â¿Preparados para los retos?
        </a>
        Â· <a href="{% url 'qr_image' pack.pk 'reto' %}">Descargar QR</a>
      </p>
      <form method="post" action="{% url 'link_regenerate' pack.pk 'reto' %}" class="inline">
        {% csrf_token %}
        <button type="submit" class="btn btn-secondary btn-sm"
                onclick="return confirm('Â¿Regenerar enlace de Reto? El anterior dejarÃ¡ de funcionar.')">
          Regenerar enlace
        </button>
      </form>
    </div>
  </div>
{% endblock %}
