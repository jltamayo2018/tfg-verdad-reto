{% extends "base.html" %}
{% block title %}{{ pack.name }}{% endblock %}

{% block content %}
  <h2 class="neon-title">{{ pack.name }}</h2>

  <p class="muted" style="margin-top:-6px;">
    Creado el {{ pack.creation_date|date:"d/m/Y H:i" }}
  </p>

  <p style="margin:.6rem 0 1rem;">
    <a class="btn btn-secondary btn-sm" href="{% url 'pack_rename' pack.pk %}">âœï¸ Cambiar nombre del pack</a>
    <a class="btn btn-ghost" href="{% url 'dashboard' %}">â† Volver a mis packs</a>
  </p>

  <!-- ACCIONES DEL PACK -->
  <div class="card neon-card pack-detail">
    <h3>Acciones del pack</h3>

    <!-- VERDAD -->
    <details class="accordion">
      <summary class="accordion-header">
        <span class="chip chip-truth">Preguntas</span>
        <a class="btn btn-primary btn-sm" href="{% url 'action_create' pack.pk 'verdad' %}">+ AÃ±adir Pregunta</a>
      </summary>

      {% if verdades %}
        <ul class="list-clean">
          {% for a in verdades %}
            <li class="action-item">
              <div class="action-text">
                {% if not a.active %}
                  <span class="badge badge-inactive">(inactiva)</span>
                {% endif %}
                {{ a.text|default:"(sin texto)" }}
              </div>

              <div class="action-tools">
                <a class="icon-btn" href="{% url 'action_edit' pack.pk a.pk %}" title="Editar" aria-label="Editar">âœï¸</a>

                <form method="post" action="{% url 'action_toggle' pack.pk a.pk %}" class="inline">
                  {% csrf_token %}
                  <button type="submit"
                          class="icon-btn"
                          title="{% if a.active %}Desactivar{% else %}Activar{% endif %}"
                          aria-label="{% if a.active %}Desactivar{% else %}Activar{% endif %}">
                    {% if a.active %}â›”{% else %}âœ…{% endif %}
                  </button>
                </form>

                <a class="icon-btn danger" href="{% url 'action_delete' pack.pk a.pk %}" title="Borrar" aria-label="Borrar">ğŸ—‘ï¸</a>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="muted">No hay verdades todavÃ­a.</p>
      {% endif %}
    </details>

    <!-- RETO -->
    <details class="accordion">
      <summary class="accordion-header">
        <span class="chip chip-dare">Retos</span>
        <a class="btn btn-primary btn-sm" href="{% url 'action_create' pack.pk 'reto' %}">+ AÃ±adir Reto</a>
      </summary>

      {% if retos %}
        <ul class="list-clean">
          {% for a in retos %}
            <li class="action-item">
              <div class="action-text">
                {% if not a.active %}
                  <span class="badge badge-inactive">(inactiva)</span>
                {% endif %}
                {{ a.text|default:"(sin texto)" }}
              </div>

              <div class="action-tools">
                <a class="icon-btn" href="{% url 'action_edit' pack.pk a.pk %}" title="Editar" aria-label="Editar">âœï¸</a>

                <form method="post" action="{% url 'action_toggle' pack.pk a.pk %}" class="inline">
                  {% csrf_token %}
                  <button type="submit"
                          class="icon-btn"
                          title="{% if a.active %}Desactivar{% else %}Activar{% endif %}"
                          aria-label="{% if a.active %}Desactivar{% else %}Activar{% endif %}">
                    {% if a.active %}â›”{% else %}âœ…{% endif %}
                  </button>
                </form>

                <a class="icon-btn danger" href="{% url 'action_delete' pack.pk a.pk %}" title="Borrar" aria-label="Borrar">ğŸ—‘ï¸</a>
              </div>
            </li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="muted">No hay retos todavÃ­a.</p>
      {% endif %}
    </details>
  </div>

  <!-- ENLACE PÃšBLICO (TOKEN ÃšNICO) -->
<div class="card neon-card public-links">
  <h3>Enlace pÃºblico</h3>

  <div class="public-block">
    <p class="link-line">
      <strong>URL del pack:</strong>
      <a class="url-badge" id="link-pack" href="{% url 'publico_por_token' pack.token %}">
        {% url 'publico_por_token' pack.token %}
      </a>
    </p>

    <!-- Botonera responsive en grid -->
    <div class="btn-grid">
      <a class="btn btn-secondary" href="{% url 'publico_por_token' pack.token %}?t=verdad">Abrir Verdad</a>
      <a class="btn btn-secondary" href="{% url 'publico_por_token' pack.token %}?t=reto">Abrir Reto</a>
      <a class="btn btn-primary"   href="{% url 'qr_image' pack.pk %}">Descargar QR</a>

      <!-- El de regenerar es POST: lo metemos en la misma grid -->
      <form method="post" action="{% url 'link_regenerate' pack.pk %}">
        {% csrf_token %}
        <button type="submit" class="btn btn-secondary"
                onclick="return confirm('Â¿Regenerar enlace del pack? El anterior dejarÃ¡ de funcionar.')">
          Regenerar enlace Ãºnico
        </button>
      </form>
    </div>
  </div>
</div>
{% endblock %}